<?php if (!defined('ABSPATH')) exit; ?>

<div class="wrap">
    <h1>eBooks</h1>
    <form method="post" action="<?php echo admin_url('admin-post.php'); ?>">
        <input type="hidden" name="action" value="add_ebook">
        <table class="form-table">
            <tr valign="top">
                <th scope="row"><label for="title">Title</label></th>
                <td><input type="text" name="title" id="title" class="regular-text" required></td>
            </tr>
            <tr valign="top">
                <th scope="row"><label for="description">Description</label></th>
                <td><textarea name="description" id="description" class="large-text" required></textarea></td>
            </tr>
            <tr valign="top">
                <th scope="row"><label for="price">Price</label></th>
                <td><input type="number" name="price" id="price" class="regular-text" step="0.01" required></td>
            </tr>
            <tr valign="top">
                <th scope="row"><label for="rrp">RRP</label></th>
                <td><input type="number" name="rrp" id="rrp" class="regular-text" step="0.01"></td>
            </tr>
            <tr valign="top">
                <th scope="row"><label for="image-url">Image URL</label></th>
                <td><input type="url" name="image_url" id="image-url" class="regular-text" required></td>
            </tr>
            <tr valign="top">
                <th scope="row"><label for="sku">SKU</label></th>
                <td><input type="text" name="sku" id="sku" class="regular-text"></td>
            </tr>
            <tr valign="top">
                <th scope="row"><label for="barcode">Barcode</label></th>
                <td><input type="text" name="barcode" id="barcode" class="regular-text"></td>
            </tr>
            <tr valign="top">
                <th scope="row"><label for="quantity">Quantity</label></th>
                <td><input type="number" name="quantity" id="quantity" class="regular-text" required></td>
            </tr>
            <tr valign="top">
                <th scope="row"><label for="file-url">File URL</label></th>
                <td><input type="url" name="file_url" id="file-url" class="regular-text" required></td>
            </tr>
        </table>
        <p class="submit"><input type="submit" class="button-primary" value="Add eBook"></p>
    </form>
    <hr>
    <h2>Existing eBooks</h2>
    <?php
    $ebooks = get_posts(array('post_type' => 'ebook', 'posts_per_page' => -1));
    if (!empty($ebooks)): ?>
        <table class="widefat fixed" cellspacing="0">
            <thead>
            <tr>
                <th id="columnname" class="manage-column column-columnname" scope="col">ID</th>
                <th id="columnname" class="manage-column column-columnname" scope="col">Title</th>
                <th id="columnname" class="manage-column column-columnname" scope="col">Type</th>
                <th id="columnname" class="manage-column column-columnname" scope="col">Price</th>
                <th id="columnname" class="manage-column column-columnname" scope="col">Quantity</th>
                <th id="columnname" class="manage-column column-columnname" scope="col">Actions</th>
            </tr>
            </thead>
            <tbody>
            <?php foreach ($ebooks as $ebook): ?>
                <tr>
                    <td><?php echo $ebook->ID; ?></td>
                    <td><?php echo $ebook->post_title; ?></td>
                    <td>eBook</td>
                    <td><?php echo get_post_meta($ebook->ID, 'price', true); ?></td>
                    <td><?php echo get_post_meta($ebook->ID, 'quantity', true); ?></td>
                    <td>
                        <a href="<?php echo get_edit_post_link($ebook->ID); ?>">Edit</a> |
                        <a href="<?php echo wp_nonce_url(admin_url('admin-post.php?action=delete_product&id=' . $ebook->ID . '&type=ebook'), 'delete-product_' . $ebook->ID); ?>" onclick="return confirm('Are you sure you want to delete this eBook?');">Delete</a>
                    </td>
                </tr>
            <?php endforeach; ?>
            </tbody>
        </table>
    <?php else: ?>
        <p>No eBooks found.</p>
    <?php endif; ?>
</div>
